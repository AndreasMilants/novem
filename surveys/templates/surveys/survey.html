{% extends '_base_post_login.html' %}
{% load i18n static %}

{% block content %}
    <article>
        <h2>{{ level }}</h2>
        <form method="post" class="survey">
            {% csrf_token %}
            {{ form_set.management_form }}
            {% for form in form_set %}
                <section class="question">
                    {{ form.non_field_errors }}
                    {{ form.source.errors }}
                    {{ form.source }}
                    {% for hidden_field in form.hidden_fields %}
                        {{ hidden_field.errors }}
                        {{ hidden_field }}
                    {% endfor %}
                    <div class="q">
                        {{ form.answer.label }}
                        <div class="slider">
                            {{ form.answer }}
                            <div class="background-input-range left"></div>
                            <div class="background-input-range right"></div>
                        </div>
                    </div>
                </section>
            {% endfor %}
            <div class="survey-next-buttons">
                {% if page > 1 %}
                    <button type="submit" id="previous-button">{% trans 'Previous' %}</button>
                {% endif %}
                <button type="submit">{% trans 'Next' %}</button>
            </div>
        </form>
    </article>
    <script>
        window.addEventListener("load", initForm, false);

        function initForm() {
            previousButton();
            addBackGrounds();
        }

        function previousButton() {
            try {
                let pB = document.getElementById("previous-button");
                pB.addEventListener("click", clickedPrevious, false);
            } catch (e) {

            }
        }

        function clickedPrevious() {
            let form = document.getElementsByClassName("survey")[0];
            let input = document.createElement("input");
            input.name = "previous";
            input.value = "true";
            input.type = "hidden";
            form.appendChild(input);
        }

        function addBackGrounds() {
            let inputs = document.querySelectorAll("input[type=range]");
            for (let i = 0; i < inputs.length; i++) {
                inputs[i].addEventListener("input", changeBackGroundWEvent, false);
                changeBackGround(inputs[i]);
            }
        }

        function changeBackGroundWEvent(event) {
            changeBackGround(event.target);
        }

        function changeBackGround(slider) {
            let value = slider.value;
            let percentage = (value - slider.min) / (slider.max - slider.min);
            let color = "rgb(" + Math.round(255 - 255 * percentage) + "," + Math.round(255 * percentage) + ",20)";
            let left = slider.parentElement.childNodes[3];
            let right = slider.parentElement.childNodes[5];
            if (value > slider.max - (slider.max - slider.min) / 2) {
                left.style.width = "0";
                let w = value / slider.max * 50 * .9;
                right.style.width = w + "%";
            } else {
                right.style.width = "0";
                let w = Math.abs(value / slider.max * 50 * .9);
                left.style.width = w + "%";
            }
            right.style.backgroundColor = color;
            left.style.backgroundColor = color;
        }

        function getShowedWidth(value, max) {

        }
    </script>
{% endblock content %}